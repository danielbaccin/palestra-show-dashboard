<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Ranking de Vendedores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    h2 {
      margin: 30px 0 10px;
    }

    /* LOADER */
    #loader {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 60vh;
      flex-direction: column;
      gap: 12px;
      color: #555;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 5px solid #ddd;
      border-top-color: #2563eb;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* TOP 3 CARDS */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-bottom: 30px;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      text-align: center;
    }

    .card h3 {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }

    .card p {
      font-size: 20px;
      font-weight: bold;
      margin: 0;
    }

    .gold { color: #d97706; }
    .silver { color: #9ca3af; }
    .bronze { color: #b45309; }

    /* CONTROLS */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 12px;
    }

    input, select {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 14px;
    }

    /* TABLE */
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    thead {
      background: #2563eb;
      color: #fff;
    }

    th, td {
      padding: 12px;
      font-size: 14px;
      text-align: left;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    .ranking {
      text-align: center;
      font-weight: bold;
    }

    .money {
      color: #16a34a;
      font-weight: bold;
    }

    footer {
      text-align: center;
      margin-top: 30px;
      font-size: 12px;
      color: #888;
    }
  </style>
</head>
<body>

<h1>üèÜ Ranking de Vendedores</h1>

<div id="loader">
  <div class="spinner"></div>
  <div>Carregando ranking...</div>
</div>

<div id="content" style="display:none;">

  <!-- TOP 3 -->
  <div class="grid" id="top3"></div>

  <!-- CONTROLS -->
  <div class="controls">
    <input type="text" id="search" placeholder="Buscar vendedor..." />
    <select id="limit">
      <option value="all">Todos</option>
      <option value="10">Top 10</option>
      <option value="20">Top 20</option>
    </select>
  </div>

  <!-- TABLE -->
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Vendedor</th>
        <th>Total</th>
        <th>Inteiras</th>
        <th>Meias</th>
        <th>Valor</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

</div>

<footer>
  Auto refresh a cada 30 segundos ‚Ä¢ Kenuiworks.cloud
</footer>

<script>
  const RANKING_URL = 'https://n8n.kenuiworks.cloud/webhook/ranking-vendedores';
  const REFRESH_INTERVAL = 30000;

  let fullData = [];

  function money(v) {
    return Number(v).toLocaleString('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    });
  }

  function renderTop3(data) {
    const el = document.getElementById('top3');
    el.innerHTML = '';

    const medals = ['gold', 'silver', 'bronze'];

    data.slice(0, 3).forEach((v, i) => {
      el.innerHTML += `
        <div class="card ${medals[i]}">
          <h3>${i + 1}¬∫ lugar</h3>
          <p>${v.vendedor}</p>
          <p>${money(v.valor)}</p>
        </div>
      `;
    });
  }

  function renderTable() {
    const search = document.getElementById('search').value.toLowerCase();
    const limit = document.getElementById('limit').value;

    let data = [...fullData];

    if (search) {
      data = data.filter(v =>
        v.vendedor.toLowerCase().includes(search)
      );
    }

    if (limit !== 'all') {
      data = data.slice(0, Number(limit));
    }

    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';

    data.forEach(v => {
      tbody.innerHTML += `
        <tr>
          <td class="ranking">${v.ranking}</td>
          <td>${v.vendedor}</td>
          <td>${v.qtdTotal}</td>
          <td>${v.qtdInteiras}</td>
          <td>${v.qtdMeias}</td>
          <td class="money">${money(v.valor)}</td>
        </tr>
      `;
    });
  }

  function loadData() {
    fetch(RANKING_URL)
      .then(r => r.json())
      .then(data => {
        fullData = data;
        renderTop3(data);
        renderTable();

        document.getElementById('loader').style.display = 'none';
        document.getElementById('content').style.display = 'block';
      })
      .catch(() => {
        document.getElementById('loader').innerText =
          'Erro ao carregar ranking';
      });
  }

  document.getElementById('search').addEventListener('input', renderTable);
  document.getElementById('limit').addEventListener('change', renderTable);

  loadData();
  setInterval(loadData, REFRESH_INTERVAL);
</script>

</body>
</html>
